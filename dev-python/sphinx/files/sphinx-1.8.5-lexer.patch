From b31c625f773ef00905acd0c434d6b173a5a84f68 Mon Sep 17 00:00:00 2001
From: Timo Kaufmann <timokau@zoho.com>
Date: Thu, 23 Jan 2020 10:34:09 +0100
Subject: [PATCH] Use the proper python2 pygments lexer

---
 sphinx/highlighting.py | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/sphinx/highlighting.py b/sphinx/highlighting.py
index ac2bd1b06..2b371279c 100644
--- a/sphinx/highlighting.py
+++ b/sphinx/highlighting.py
@@ -16,8 +16,14 @@ from pygments.filters import ErrorToken
 from pygments.formatters import HtmlFormatter, LatexFormatter
 from pygments.lexer import Lexer  # NOQA
 from pygments.lexers import get_lexer_by_name, guess_lexer
-from pygments.lexers import PythonLexer, Python3Lexer, PythonConsoleLexer, \
+from pygments.lexers import Python3Lexer, PythonConsoleLexer, \
     CLexer, TextLexer, RstLexer
+try:
+    # PythonLexer was renamed to Python2Lexer in pygments 2.5
+    from pygments.lexers import Python2Lexer
+except ImportError:
+    # Fallback for pygments <2.5
+    from pygments.lexers import PythonLexer as Python2Lexer
 from pygments.styles import get_style_by_name
 from pygments.util import ClassNotFound
 from six import text_type
@@ -40,7 +46,7 @@ logger = logging.getLogger(__name__)
 
 lexers = dict(
     none = TextLexer(stripnl=False),
-    python = PythonLexer(stripnl=False),
+    python = Python2Lexer(stripnl=False),
     python3 = Python3Lexer(stripnl=False),
     pycon = PythonConsoleLexer(stripnl=False),
     pycon3 = PythonConsoleLexer(python3=True, stripnl=False),
-- 
2.24.1
