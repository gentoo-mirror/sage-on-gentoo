From bb4f0a9c656b52579ca7fabcc43fd72804e0e318 Mon Sep 17 00:00:00 2001
From: Jeroen Demeyer <jdemeyer@cage.ugent.be>
Date: Thu, 8 Feb 2018 17:49:42 +0100
Subject: [PATCH] Use NamedTemporaryFile instead of mkstemp

---
 Cython/Debugger/libpython.py | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/Cython/Debugger/libpython.py b/Cython/Debugger/libpython.py
index 9e94168a0..dc3e44a47 100644
--- a/Cython/Debugger/libpython.py
+++ b/Cython/Debugger/libpython.py
@@ -1941,7 +1941,6 @@ def get_namespace(self, pyop_frame):
 ##################################################################
 
 import re
-import atexit
 import warnings
 import tempfile
 import textwrap
@@ -2023,14 +2022,13 @@ class _LoggingState(object):
     """
 
     def __init__(self):
-        self.fd, self.filename = tempfile.mkstemp()
-        self.file = os.fdopen(self.fd, 'r+')
+        f = tempfile.NamedTemporaryFile('r+')
+        self.file = f
+        self.filename = f.name
+        self.fd = f.fileno()
         _execute("set logging file %s" % self.filename)
         self.file_position_stack = []
 
-        atexit.register(os.close, self.fd)
-        atexit.register(os.remove, self.filename)
-
     def __enter__(self):
         if not self.file_position_stack:
             _execute("set logging redirect on")
