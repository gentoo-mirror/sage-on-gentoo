diff --git a/sage_setup/command/sage_build_ext.py b/sage_setup/command/sage_build_ext.py
index 9cca775..99217ec 100644
--- a/sage_setup/command/sage_build_ext.py
+++ b/sage_setup/command/sage_build_ext.py
@@ -16,11 +16,37 @@ except ImportError:
 from sage_setup.run_parallel import execute_list_of_commands
 
 class sage_build_ext(build_ext):
+    def run_autogen(self):
+        """
+        Generate auto-generated sources.
+
+        This must be done before building the python modules,
+        see :trac:`22106`.
+        """
+        from sage_setup.autogen import autogen_all
+        from sage_setup.find import find_python_sources
+        from sage.env import SAGE_SRC
+
+        log.info("Generating auto-generated sources")
+
+        pkgs = autogen_all()
+        python_packages, python_modules, cython_modules = find_python_sources(
+            SAGE_SRC, [ pkg.replace('.', '/') for pkg in pkgs])
+
+        for pkg in python_packages:
+            if pkg not in self.distribution.packages:
+                self.distribution.packages.append(pkg)
+
+        for cython_module in cython_modules:
+            self.distribution.ext_modules.append(cython_module)
+
     def finalize_options(self):
         build_ext.finalize_options(self)
         self.check_flags()
 
     def run(self):
+        # Run autogeneration first
+        self.run_autogen()
         # Always run the Cythonize command before building extensions
         self.run_command('build_cython')
         build_ext.run(self)
